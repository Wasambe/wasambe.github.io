
<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" href="foundation.css" />
<link rel="stylesheet" href="app.css" />
<link rel="stylesheet" href="d3-context-menu.css" />
  <title>indexMW.html</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
 <!--
 <meta name="robots" content="noindex, nofollow">
  <meta name="googlebot" content="noindex, nofollow">
  <meta name="viewport" content="width=device-width, initial-scale=1">
-->

  <!-- <script type="text/javascript" src="d3.v3.js"></script> -->
 <!-- <script src="https://d3js.org/d3.v5.js"></script> -->
  <script src="d3.v6.6.0.js"></script>
    <script>
        var d3v6 = window.d3;
        window.d3 = null;
    </script>
 <!--   <script src="https://d3js.org/d3.v3.js"></script> -->
   <script src="d3.v3.js"></script>

<!-- <link rel="stylesheet" type="text/css" href="d3-context-menu.css"></style> -->
        <script src="d3-context-menu.js"></script>
      	   <script src="underscore-min.js"></script>
        <script src="jquery.js"></script>
        <script src="fastclick.js"></script>
        <script src="foundation.min.js"></script>
		
		



   <!-- <link rel="stylesheet" type="text/css" href="/css/result-light.css"> -->


  <style id="compiled-css" type="text/css">
      .node {
    cursor: pointer;
}
.node circle {
    fill: #fff;
    stroke: steelblue;
    stroke-width: 1.5px;
}
.node text {
    font: 10px sans-serif;
}
.link {
    fill: none;
    stroke: #ccc;
    stroke-width: 1.5px;
}

body {
    overflow: hidden;
}
    /* EOS */
  </style>

  <script id="insert"></script>


</head>
<body>
    <div id="body"></div>
	
	
	 <div id="RenameNodeModal" class="reveal-modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
          <h2 id="modalTitle">Rename Node</h2>
          <form id="RenameNodeForm">
            <div class="row">
              <div class="large-12 columns">
                <label>Node name
                  <input type="text" class="inputName" id='RenameNodeName' placeholder="node name" />
                </label>
              </div>
            </div>
            <div class="row">
              <div class="large-8 columns">
                &nbsp;
              </div>
              <div class="large-4 columns">
                <a href="#" class="button info" onclick="close_rename_node_modal()">Cancel</a>
                <a href="#" class="button success" onclick="rename_node()">Rename</a>
              </div>
            </div>
          </form>
          <a class="close-reveal-modal" aria-label="Close">&#215;</a>
        </div>

        <div id="CreateNodeModal" class="reveal-modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
          <h2 id="modalTitle">Create Node</h2>
          <form id="CreateNodeForm">
            <div class="row">
              <div class="large-12 columns">
                <label>Node name
                  <input type="text" class="inputName" id='CreateNodeName' placeholder="node name" />
                </label>
              </div>
            </div>
            <div class="row">
              <div class="large-8 columns">
                &nbsp;
              </div>
              <div class="large-4 columns">
                <a href="#" class="button info" onclick="close_create_node_modal()">Cancel</a>
                <a href="#" class="button success" onclick="create_node()">Create</a>
              </div>
            </div>
          </form>
          <a class="close-reveal-modal" aria-label="Close">&#215;</a>
        </div>

	
	
	<div id="tree-container"></div>

    <script type="text/javascript">//<![CDATA[
	

function close_modal() {
        $(document).foundation('reveal', 'close');
}


var tree_root;
var create_node_modal_active = false;
var rename_node_modal_active = false;
var create_node_parent = null;
var node_to_rename = null;


function generateUUID(){
    var d = new Date().getTime();
    var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        var r = (d + Math.random()*16)%16 | 0;
        d = Math.floor(d/16);
        return (c=='x' ? r : (r&0x3|0x8)).toString(16);
    });
    return uuid;
};



function create_node() {
        if (create_node_parent && create_node_modal_active) {
                if (create_node_parent._children != null)  {
                        create_node_parent.children = create_node_parent._children;
                        create_node_parent._children = null;
                }
                if (create_node_parent.children == null) {
                        create_node_parent.children = [];
                }
                id = generateUUID(); 
                name = $('#CreateNodeName').val();
                new_node = { 'name': name, 
                             'id' :  id,
                             'depth': create_node_parent.depth + 1,                           
                             'children': [], 
                             '_children':null 
                           };
                console.log('Create Node name: ' + name);
                create_node_parent.children.push(new_node);
                create_node_modal_active = false;
                $('#CreateNodeName').val('');

        }
        close_modal();
        outer_update(create_node_parent);
}



	
	function rename_node() {
        if (node_to_rename && rename_node_modal_active) {
                name = $('#RenameNodeName').val();
                console.log('New Node name: ' + name);
                node_to_rename.name = name;
                rename_node_modal_active = false;

        }
        close_modal();
        outer_update(node_to_rename);
}


outer_update = null;


// Calculate total nodes, max label length
    var totalNodes = 0;
    var maxLabelLength = 0;
    // variables for drag/drop
    var selectedNode = null;
    var draggingNode = null;
    // panning variables
    var panSpeed = 200;
    var panBoundary = 20; // Within 20px from edges will pan when dragging.
    // Misc. variables
    var i = 0;
    var duration = 750;
    var root;

    // size of the diagram
    var viewerWidth = $(document).width();
    var viewerHeight = $(document).height();

    var tree = d3.layout.tree()
        .size([viewerHeight, viewerWidth]);

	
	
	
var margin = {
    top: 20,
    right: 120,
    bottom: 20,
    left: 120
},
width = 960 - margin.right - margin.left,
height = 800 - margin.top - margin.bottom;


var datachaneystr = ("[{\"name\":\"1Chaney\",\"childidvar\":1,\"parentidvar\":\"\",\"parent\":\"\"},{\"name\":\"2Sally\",\"childidvar\":2,\"parentidvar\":1,\"parent\":\"1Chaney\"},{\"name\":\"3John\",\"childidvar\":3,\"parentidvar\":1,\"parent\":\"1Chaney\"},{\"name\":\"4Mary\",\"childidvar\":4,\"parentidvar\":1,\"parent\":\"1Chaney\"},{\"name\":\"5William\",\"childidvar\":5,\"parentidvar\":1,\"parent\":\"1Chaney\"},{\"name\":\"7John\",\"childidvar\":7,\"parentidvar\":5,\"parent\":\"5William\"},{\"name\":\"8George\",\"childidvar\":8,\"parentidvar\":5,\"parent\":\"5William\"},{\"name\":\"9Mamie\",\"childidvar\":9,\"parentidvar\":5,\"parent\":\"5William\"},{\"name\":\"10Cornnelia\",\"childidvar\":10,\"parentidvar\":5,\"parent\":\"5William\"},{\"name\":\"11Bessie\",\"childidvar\":11,\"parentidvar\":5,\"parent\":\"5William\"},{\"name\":\"12James\",\"childidvar\":12,\"parentidvar\":5,\"parent\":\"5William\"},{\"name\":\"13Sallie\",\"childidvar\":13,\"parentidvar\":5,\"parent\":\"5William\"},{\"name\":\"14William\",\"childidvar\":14,\"parentidvar\":5,\"parent\":\"5William\"},{\"name\":\"15Joe Thomas\",\"childidvar\":15,\"parentidvar\":5,\"parent\":\"5William\"},{\"name\":\"17Gladys\",\"childidvar\":17,\"parentidvar\":15,\"parent\":\"15Joe Thomas\"},{\"name\":\"25Dora\",\"childidvar\":25,\"parentidvar\":17,\"parent\":\"17Gladys\"},{\"name\":\"49Bruce Jr\",\"childidvar\":49,\"parentidvar\":25,\"parent\":\"25Dora\"},{\"name\":\"100Melody\",\"childidvar\":100,\"parentidvar\":49,\"parent\":\"49Bruce Jr\"},{\"name\":\"161Breasha\",\"childidvar\":161,\"parentidvar\":100,\"parent\":\"100Melody\"},{\"name\":\"101Bruce 3rd\",\"childidvar\":101,\"parentidvar\":49,\"parent\":\"49Bruce Jr\"},{\"name\":\"162Bruce 4th\",\"childidvar\":162,\"parentidvar\":101,\"parent\":\"101Bruce 3rd\"},{\"name\":\"102Damarcus\",\"childidvar\":102,\"parentidvar\":49,\"parent\":\"49Bruce Jr\"},{\"name\":\"50Cheryl\",\"childidvar\":50,\"parentidvar\":25,\"parent\":\"25Dora\"},{\"name\":\"51James\",\"childidvar\":51,\"parentidvar\":25,\"parent\":\"25Dora\"},{\"name\":\"103Victoria\",\"childidvar\":103,\"parentidvar\":51,\"parent\":\"51James\"},{\"name\":\"163Jaiden\",\"childidvar\":163,\"parentidvar\":103,\"parent\":\"103Victoria\"},{\"name\":\"164Amiwah\",\"childidvar\":164,\"parentidvar\":103,\"parent\":\"103Victoria\"},{\"name\":\"165Jayce\",\"childidvar\":165,\"parentidvar\":103,\"parent\":\"103Victoria\"},{\"name\":\"104Olivia\",\"childidvar\":104,\"parentidvar\":51,\"parent\":\"51James\"},{\"name\":\"52Lisa\",\"childidvar\":52,\"parentidvar\":25,\"parent\":\"25Dora\"},{\"name\":\"105Brittany\",\"childidvar\":105,\"parentidvar\":52,\"parent\":\"52Lisa\"},{\"name\":\"106Anthony\",\"childidvar\":106,\"parentidvar\":52,\"parent\":\"52Lisa\"},{\"name\":\"107Donte\",\"childidvar\":107,\"parentidvar\":52,\"parent\":\"52Lisa\"},{\"name\":\"53Tony\",\"childidvar\":53,\"parentidvar\":25,\"parent\":\"25Dora\"},{\"name\":\"108Brandon\",\"childidvar\":108,\"parentidvar\":53,\"parent\":\"53Tony\"},{\"name\":\"109Marcus\",\"childidvar\":109,\"parentidvar\":53,\"parent\":\"53Tony\"},{\"name\":\"1103rd child\",\"childidvar\":110,\"parentidvar\":53,\"parent\":\"53Tony\"},{\"name\":\"26Don\",\"childidvar\":26,\"parentidvar\":17,\"parent\":\"17Gladys\"},{\"name\":\"54Donna\",\"childidvar\":54,\"parentidvar\":26,\"parent\":\"26Don\"},{\"name\":\"111Neaisha\",\"childidvar\":111,\"parentidvar\":54,\"parent\":\"54Donna\"},{\"name\":\"55Debbie\",\"childidvar\":55,\"parentidvar\":26,\"parent\":\"26Don\"},{\"name\":\"56Danita\",\"childidvar\":56,\"parentidvar\":26,\"parent\":\"26Don\"},{\"name\":\"112Brandon\",\"childidvar\":112,\"parentidvar\":56,\"parent\":\"56Danita\"},{\"name\":\"166Heavenly\",\"childidvar\":166,\"parentidvar\":112,\"parent\":\"112Brandon\"},{\"name\":\"167CamRyn\",\"childidvar\":167,\"parentidvar\":112,\"parent\":\"112Brandon\"},{\"name\":\"168Elizabeth\",\"childidvar\":168,\"parentidvar\":112,\"parent\":\"112Brandon\"},{\"name\":\"178Eliyanni\",\"childidvar\":178,\"parentidvar\":112,\"parent\":\"112Brandon\"},{\"name\":\"27Juanita\",\"childidvar\":27,\"parentidvar\":17,\"parent\":\"17Gladys\"},{\"name\":\"57Benny\",\"childidvar\":57,\"parentidvar\":27,\"parent\":\"27Juanita\"},{\"name\":\"113Daniel\",\"childidvar\":113,\"parentidvar\":57,\"parent\":\"57Benny\"},{\"name\":\"114Tyree\",\"childidvar\":114,\"parentidvar\":57,\"parent\":\"57Benny\"},{\"name\":\"58James\",\"childidvar\":58,\"parentidvar\":27,\"parent\":\"27Juanita\"},{\"name\":\"115Marquis\",\"childidvar\":115,\"parentidvar\":58,\"parent\":\"58James\"},{\"name\":\"59Kim\",\"childidvar\":59,\"parentidvar\":27,\"parent\":\"27Juanita\"},{\"name\":\"116Kayden\",\"childidvar\":116,\"parentidvar\":59,\"parent\":\"59Kim\"},{\"name\":\"117Jayden\",\"childidvar\":117,\"parentidvar\":59,\"parent\":\"59Kim\"},{\"name\":\"18Lillie\",\"childidvar\":18,\"parentidvar\":15,\"parent\":\"15Joe Thomas\"},{\"name\":\"28Wyatt\",\"childidvar\":28,\"parentidvar\":18,\"parent\":\"18Lillie\"},{\"name\":\"60Michelle\",\"childidvar\":60,\"parentidvar\":28,\"parent\":\"28Wyatt\"},{\"name\":\"118Devon\",\"childidvar\":118,\"parentidvar\":60,\"parent\":\"60Michelle\"},{\"name\":\"61Sherisse\",\"childidvar\":61,\"parentidvar\":28,\"parent\":\"28Wyatt\"},{\"name\":\"119Achinae\",\"childidvar\":119,\"parentidvar\":61,\"parent\":\"61Sherisse\"},{\"name\":\"120Wayne\",\"childidvar\":120,\"parentidvar\":61,\"parent\":\"61Sherisse\"},{\"name\":\"29Kay\",\"childidvar\":29,\"parentidvar\":18,\"parent\":\"18Lillie\"},{\"name\":\"62Antonio\",\"childidvar\":62,\"parentidvar\":29,\"parent\":\"29Kay\"},{\"name\":\"63Thomas\",\"childidvar\":63,\"parentidvar\":29,\"parent\":\"29Kay\"},{\"name\":\"30Constance\",\"childidvar\":30,\"parentidvar\":18,\"parent\":\"18Lillie\"},{\"name\":\"64James Jr\",\"childidvar\":64,\"parentidvar\":30,\"parent\":\"30Constance\"},{\"name\":\"121Sheneka\",\"childidvar\":121,\"parentidvar\":64,\"parent\":\"64James Jr\"},{\"name\":\"122Jamesha\",\"childidvar\":122,\"parentidvar\":64,\"parent\":\"64James Jr\"},{\"name\":\"65Cynthia\",\"childidvar\":65,\"parentidvar\":30,\"parent\":\"30Constance\"},{\"name\":\"123Constance\",\"childidvar\":123,\"parentidvar\":65,\"parent\":\"65Cynthia\"},{\"name\":\"31Angela\",\"childidvar\":31,\"parentidvar\":18,\"parent\":\"18Lillie\"},{\"name\":\"66April\",\"childidvar\":66,\"parentidvar\":31,\"parent\":\"31Angela\"},{\"name\":\"67Kimmey\",\"childidvar\":67,\"parentidvar\":31,\"parent\":\"31Angela\"},{\"name\":\"68Carl\",\"childidvar\":68,\"parentidvar\":31,\"parent\":\"31Angela\"},{\"name\":\"32Sabrina\",\"childidvar\":32,\"parentidvar\":18,\"parent\":\"18Lillie\"},{\"name\":\"69Wayneman\",\"childidvar\":69,\"parentidvar\":32,\"parent\":\"32Sabrina\"},{\"name\":\"172Cameron\",\"childidvar\":172,\"parentidvar\":69,\"parent\":\"69Wayneman\"},{\"name\":\"70Richard\",\"childidvar\":70,\"parentidvar\":32,\"parent\":\"32Sabrina\"},{\"name\":\"173Alexis\",\"childidvar\":173,\"parentidvar\":70,\"parent\":\"70Richard\"},{\"name\":\"174Leila\",\"childidvar\":174,\"parentidvar\":70,\"parent\":\"70Richard\"},{\"name\":\"71Tameka\",\"childidvar\":71,\"parentidvar\":32,\"parent\":\"32Sabrina\"},{\"name\":\"72Tamara\",\"childidvar\":72,\"parentidvar\":32,\"parent\":\"32Sabrina\"},{\"name\":\"175Tyshaun\",\"childidvar\":175,\"parentidvar\":72,\"parent\":\"72Tamara\"},{\"name\":\"176Miracle\",\"childidvar\":176,\"parentidvar\":72,\"parent\":\"72Tamara\"},{\"name\":\"177Journey\",\"childidvar\":177,\"parentidvar\":72,\"parent\":\"72Tamara\"},{\"name\":\"33Sheila\",\"childidvar\":33,\"parentidvar\":18,\"parent\":\"18Lillie\"},{\"name\":\"73Angel\",\"childidvar\":73,\"parentidvar\":33,\"parent\":\"33Sheila\"},{\"name\":\"74Jack\",\"childidvar\":74,\"parentidvar\":33,\"parent\":\"33Sheila\"},{\"name\":\"75Benjamin Jr\",\"childidvar\":75,\"parentidvar\":33,\"parent\":\"33Sheila\"},{\"name\":\"124Deja\",\"childidvar\":124,\"parentidvar\":75,\"parent\":\"75Benjamin Jr\"},{\"name\":\"125Benjamin 3rd\",\"childidvar\":125,\"parentidvar\":75,\"parent\":\"75Benjamin Jr\"},{\"name\":\"34Richard\",\"childidvar\":34,\"parentidvar\":18,\"parent\":\"18Lillie\"},{\"name\":\"76Ricardo\",\"childidvar\":76,\"parentidvar\":34,\"parent\":\"34Richard\"},{\"name\":\"77Kaylyn\",\"childidvar\":77,\"parentidvar\":34,\"parent\":\"34Richard\"},{\"name\":\"78Kennedy\",\"childidvar\":78,\"parentidvar\":34,\"parent\":\"34Richard\"},{\"name\":\"19Joseph\",\"childidvar\":19,\"parentidvar\":15,\"parent\":\"15Joe Thomas\"},{\"name\":\"20Lucille\",\"childidvar\":20,\"parentidvar\":15,\"parent\":\"15Joe Thomas\"},{\"name\":\"21Ruth\",\"childidvar\":21,\"parentidvar\":15,\"parent\":\"15Joe Thomas\"},{\"name\":\"35Thomas Jr\",\"childidvar\":35,\"parentidvar\":21,\"parent\":\"21Ruth\"},{\"name\":\"79Thomas 3rd\",\"childidvar\":79,\"parentidvar\":35,\"parent\":\"35Thomas Jr\"},{\"name\":\"126Thomas\",\"childidvar\":126,\"parentidvar\":79,\"parent\":\"79Thomas 3rd\"},{\"name\":\"127Tariq\",\"childidvar\":127,\"parentidvar\":79,\"parent\":\"79Thomas 3rd\"},{\"name\":\"128Taiquon\",\"childidvar\":128,\"parentidvar\":79,\"parent\":\"79Thomas 3rd\"},{\"name\":\"80Shaughn\",\"childidvar\":80,\"parentidvar\":35,\"parent\":\"35Thomas Jr\"},{\"name\":\"36Sheryl\",\"childidvar\":36,\"parentidvar\":21,\"parent\":\"21Ruth\"},{\"name\":\"81Stacy\",\"childidvar\":81,\"parentidvar\":36,\"parent\":\"36Sheryl\"},{\"name\":\"82Monique\",\"childidvar\":82,\"parentidvar\":36,\"parent\":\"36Sheryl\"},{\"name\":\"129Angela\",\"childidvar\":129,\"parentidvar\":82,\"parent\":\"82Monique\"},{\"name\":\"130Brooklyn\",\"childidvar\":130,\"parentidvar\":82,\"parent\":\"82Monique\"},{\"name\":\"131Stacy\",\"childidvar\":131,\"parentidvar\":82,\"parent\":\"82Monique\"},{\"name\":\"132Lenox\",\"childidvar\":132,\"parentidvar\":82,\"parent\":\"82Monique\"},{\"name\":\"37Michael\",\"childidvar\":37,\"parentidvar\":21,\"parent\":\"21Ruth\"},{\"name\":\"38David\",\"childidvar\":38,\"parentidvar\":21,\"parent\":\"21Ruth\"},{\"name\":\"22James\",\"childidvar\":22,\"parentidvar\":15,\"parent\":\"15Joe Thomas\"},{\"name\":\"39Angela\",\"childidvar\":39,\"parentidvar\":22,\"parent\":\"22James\"},{\"name\":\"40Anita\",\"childidvar\":40,\"parentidvar\":22,\"parent\":\"22James\"},{\"name\":\"83Jessica\",\"childidvar\":83,\"parentidvar\":40,\"parent\":\"40Anita\"},{\"name\":\"133Michael Jr\",\"childidvar\":133,\"parentidvar\":83,\"parent\":\"83Jessica\"},{\"name\":\"41Michael\",\"childidvar\":41,\"parentidvar\":22,\"parent\":\"22James\"},{\"name\":\"84Michael Jr\",\"childidvar\":84,\"parentidvar\":41,\"parent\":\"41Michael\"},{\"name\":\"85Erica\",\"childidvar\":85,\"parentidvar\":41,\"parent\":\"41Michael\"},{\"name\":\"23Clara\",\"childidvar\":23,\"parentidvar\":15,\"parent\":\"15Joe Thomas\"},{\"name\":\"42Phylis\",\"childidvar\":42,\"parentidvar\":23,\"parent\":\"23Clara\"},{\"name\":\"86Christian\",\"childidvar\":86,\"parentidvar\":42,\"parent\":\"42Phylis\"},{\"name\":\"43Belinda\",\"childidvar\":43,\"parentidvar\":23,\"parent\":\"23Clara\"},{\"name\":\"87Markel\",\"childidvar\":87,\"parentidvar\":43,\"parent\":\"43Belinda\"},{\"name\":\"24John\",\"childidvar\":24,\"parentidvar\":15,\"parent\":\"15Joe Thomas\"},{\"name\":\"44Juanda\",\"childidvar\":44,\"parentidvar\":24,\"parent\":\"24John\"},{\"name\":\"88Tawanda\",\"childidvar\":88,\"parentidvar\":44,\"parent\":\"44Juanda\"},{\"name\":\"134Cederick\",\"childidvar\":134,\"parentidvar\":88,\"parent\":\"88Tawanda\"},{\"name\":\"169Kellan\",\"childidvar\":169,\"parentidvar\":134,\"parent\":\"134Cederick\"},{\"name\":\"170Kayliah\",\"childidvar\":170,\"parentidvar\":134,\"parent\":\"134Cederick\"},{\"name\":\"135Ananda\",\"childidvar\":135,\"parentidvar\":88,\"parent\":\"88Tawanda\"},{\"name\":\"171Kynlee\",\"childidvar\":171,\"parentidvar\":135,\"parent\":\"135Ananda\"},{\"name\":\"179Kiyle\",\"childidvar\":179,\"parentidvar\":135,\"parent\":\"135Ananda\"},{\"name\":\"89Kristopher\",\"childidvar\":89,\"parentidvar\":44,\"parent\":\"44Juanda\"},{\"name\":\"136Caleb\",\"childidvar\":136,\"parentidvar\":89,\"parent\":\"89Kristopher\"},{\"name\":\"137Amami\",\"childidvar\":137,\"parentidvar\":89,\"parent\":\"89Kristopher\"},{\"name\":\"138Arionna\",\"childidvar\":138,\"parentidvar\":89,\"parent\":\"89Kristopher\"},{\"name\":\"139Kristolyn\",\"childidvar\":139,\"parentidvar\":89,\"parent\":\"89Kristopher\"},{\"name\":\"140Chaun\",\"childidvar\":140,\"parentidvar\":89,\"parent\":\"89Kristopher\"},{\"name\":\"141Jayden\",\"childidvar\":141,\"parentidvar\":89,\"parent\":\"89Kristopher\"},{\"name\":\"45Yolanda\",\"childidvar\":45,\"parentidvar\":24,\"parent\":\"24John\"},{\"name\":\"46John Jr\",\"childidvar\":46,\"parentidvar\":24,\"parent\":\"24John\"},{\"name\":\"90Derrick\",\"childidvar\":90,\"parentidvar\":46,\"parent\":\"46John Jr\"},{\"name\":\"142Hannah\",\"childidvar\":142,\"parentidvar\":90,\"parent\":\"90Derrick\"},{\"name\":\"143Jaydon\",\"childidvar\":143,\"parentidvar\":90,\"parent\":\"90Derrick\"},{\"name\":\"144Aiden\",\"childidvar\":144,\"parentidvar\":90,\"parent\":\"90Derrick\"},{\"name\":\"145Addison\",\"childidvar\":145,\"parentidvar\":90,\"parent\":\"90Derrick\"},{\"name\":\"146Alania\",\"childidvar\":146,\"parentidvar\":90,\"parent\":\"90Derrick\"},{\"name\":\"147Asher\",\"childidvar\":147,\"parentidvar\":90,\"parent\":\"90Derrick\"},{\"name\":\"91Brandon\",\"childidvar\":91,\"parentidvar\":46,\"parent\":\"46John Jr\"},{\"name\":\"148Jackson\",\"childidvar\":148,\"parentidvar\":91,\"parent\":\"91Brandon\"},{\"name\":\"149Jordan\",\"childidvar\":149,\"parentidvar\":91,\"parent\":\"91Brandon\"},{\"name\":\"92Candice\",\"childidvar\":92,\"parentidvar\":46,\"parent\":\"46John Jr\"},{\"name\":\"93Joseph\",\"childidvar\":93,\"parentidvar\":46,\"parent\":\"46John Jr\"},{\"name\":\"150Joseph\",\"childidvar\":150,\"parentidvar\":93,\"parent\":\"93Joseph\"},{\"name\":\"151Cohen\",\"childidvar\":151,\"parentidvar\":93,\"parent\":\"93Joseph\"},{\"name\":\"152Lillie\",\"childidvar\":152,\"parentidvar\":93,\"parent\":\"93Joseph\"},{\"name\":\"153Gracie\",\"childidvar\":153,\"parentidvar\":93,\"parent\":\"93Joseph\"},{\"name\":\"154Breelyn\",\"childidvar\":154,\"parentidvar\":93,\"parent\":\"93Joseph\"},{\"name\":\"47Tony\",\"childidvar\":47,\"parentidvar\":24,\"parent\":\"24John\"},{\"name\":\"94Teven\",\"childidvar\":94,\"parentidvar\":47,\"parent\":\"47Tony\"},{\"name\":\"95Katurah\",\"childidvar\":95,\"parentidvar\":47,\"parent\":\"47Tony\"},{\"name\":\"48Elwin\",\"childidvar\":48,\"parentidvar\":24,\"parent\":\"24John\"},{\"name\":\"96Latosha\",\"childidvar\":96,\"parentidvar\":48,\"parent\":\"48Elwin\"},{\"name\":\"155Kyran\",\"childidvar\":155,\"parentidvar\":96,\"parent\":\"96Latosha\"},{\"name\":\"156Kaiden\",\"childidvar\":156,\"parentidvar\":96,\"parent\":\"96Latosha\"},{\"name\":\"97Elwin Jr\",\"childidvar\":97,\"parentidvar\":48,\"parent\":\"48Elwin\"},{\"name\":\"157Teagan Jr\",\"childidvar\":157,\"parentidvar\":97,\"parent\":\"97Elwin Jr\"},{\"name\":\"158Taylor\",\"childidvar\":158,\"parentidvar\":97,\"parent\":\"97Elwin Jr\"},{\"name\":\"159Toryn\",\"childidvar\":159,\"parentidvar\":97,\"parent\":\"97Elwin Jr\"},{\"name\":\"160Chailyn\",\"childidvar\":160,\"parentidvar\":97,\"parent\":\"97Elwin Jr\"},{\"name\":\"98Donte\",\"childidvar\":98,\"parentidvar\":48,\"parent\":\"48Elwin\"},{\"name\":\"99Santana\",\"childidvar\":99,\"parentidvar\":48,\"parent\":\"48Elwin\"},{\"name\":\"16Daniel\",\"childidvar\":16,\"parentidvar\":5,\"parent\":\"5William\"},{\"name\":\"6Lucy\",\"childidvar\":6,\"parentidvar\":1,\"parent\":\"1Chaney\"}]");
console.log (datachaneystr);


var root = {
    "name": "Ruth",
        "children": [{
        "name": "Tom",
            "children": [{
            "name": "Marshall",
                "children": [{
                "name": "Taj",
                    "size": 3938
            }, {
                "name": "Tariq",
                    "size": 3812
            }, {
                "name": "Taiquon",
                    "size": 6714
            }]
        }, {
            "name": "Shaughn",
                "size": 6714
        }]
    }, {
        "name": "Sheryl",
            "children": [{
            "name": "Stacy",
                "size": 17010
        }, {
            "name": "Monique",
                "children": [{
                "name": "Angela",
                    "size": 1983
            }, {
                "name": "Brooklyn",
                    "size": 2047
            }, {
                "name": "Stacy",
                    "size": 1375
            }, {
                "name": "Lenox",
                    "size": 8746
            }]
        }]
    }, {
        "name": "Michael",
              "size": 3322
            
    }, {
        "name": "Dave",
             "size": 3322
    }]
};


// arryd3fromnodesplusstr = localStorage.getItem("arrayaddallstr");
// Parse the JSON string back to JS object
 datachaneystrparsed = JSON.parse(datachaneystr); //becomes arrayaddchildstrparsed[]
	console.log(datachaneystrparsed);

datachaney = datachaneystrparsed;
console.log(datachaney);



// convert the flat data into a hierarchy 
  var rootchaney = d3v6.stratify()
  .id(function(d) { return d.name; })
  .parentId(function(d) { return d.parent; })
  (datachaney);
  console.log (datachaney);
  console.log (rootchaney);
 root = rootchaney; 
 
 
 treeData = root;

  
// assign the name to each node
root.each(function(d) {
d.name = d.id;
});



var tree = d3.layout.tree().nodeSize([70, 40]);


    var menu = [
            {
                    title: 'Rename node',
                    action: function(elm, d, i) {
                            console.log('Rename node');
                            $("#RenameNodeName").val(d.name);
                            rename_node_modal_active = true;
                            node_to_rename = d
                            $("#RenameNodeName").focus();
                            $('#RenameNodeModal').foundation('reveal', 'open');
                    }
            },
            {
                    title: 'Delete node',
                    action: function(elm, d, i) {
                            console.log('Delete node');
                            delete_node(d);
                    }
            },
            {
                    title: 'Create child node',
                    action: function(elm, d, i) {
                            console.log('Create child node');
                            create_node_parent = d;
                            create_node_modal_active = true;
                            $('#CreateNodeModal').foundation('reveal', 'open');
                            $('#CreateNodeName').focus();
                    }
            }
    ]

	
 // A recursive helper function for performing some setup by walking through all nodes

    function visit(parent, visitFn, childrenFn) {
        if (!parent) return;

        visitFn(parent);

        var children = childrenFn(parent);
        if (children) {
            var count = children.length;
            for (var i = 0; i < count; i++) {
                visit(children[i], visitFn, childrenFn);
            }
        }
    }

    // Call visit function to establish maxLabelLength
    visit(treeData, function(d) {
        totalNodes++;
        maxLabelLength = Math.max(d.name.length, maxLabelLength);

    }, function(d) {
        return d.children && d.children.length > 0 ? d.children : null;
    });

    function delete_node(node) {
        visit(treeData, function(d) {
               if (d.children) {
                       for (var child of d.children) {
                               if (child == node) {
                                       d.children = _.without(d.children, child);
                                       update(root);
                                       break;
                               }
                       } 
               }
        },
        function(d) {
           return d.children && d.children.length > 0 ? d.children : null;
       });
    }



 // sort the tree according to the node names

    function sortTree() {
        tree.sort(function(a, b) {
            return b.name.toLowerCase() < a.name.toLowerCase() ? 1 : -1;
        });
    }
    // Sort the tree initially incase the JSON isn't in a sorted order.
   // sortTree();

// TODO: Pan function, can be better implemented.

    function pan(domNode, direction) {
        var speed = panSpeed;
        if (panTimer) {
            clearTimeout(panTimer);
            translateCoords = d3.transform(svgGroup.attr("transform"));
            if (direction == 'left' || direction == 'right') {
                translateX = direction == 'left' ? translateCoords.translate[0] + speed : translateCoords.translate[0] - speed;
                translateY = translateCoords.translate[1];
            } else if (direction == 'up' || direction == 'down') {
                translateX = translateCoords.translate[0];
                translateY = direction == 'up' ? translateCoords.translate[1] + speed : translateCoords.translate[1] - speed;
            }
            scaleX = translateCoords.scale[0];
            scaleY = translateCoords.scale[1];
            scale = zoomListener.scale();
            svgGroup.transition().attr("transform", "translate(" + translateX + "," + translateY + ")scale(" + scale + ")");
            d3.select(domNode).select('g.node').attr("transform", "translate(" + translateX + "," + translateY + ")");
            zoomListener.scale(zoomListener.scale());
            zoomListener.translate([translateX, translateY]);
            panTimer = setTimeout(function() {
                pan(domNode, speed, direction);
            }, 50);
        }
    }



 // Define the zoom function for the zoomable tree

    function zoom() {
        svgGroup.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
    }


    // define the zoomListener which calls the zoom function on the "zoom" event constrained within the scaleExtents
    var zoomListener = d3.behavior.zoom().scaleExtent([0.1, 3]).on("zoom", zoom);

    function initiateDrag(d, domNode) {
        draggingNode = d;
        d3.select(domNode).select('.ghostCircle').attr('pointer-events', 'none');
        d3.selectAll('.ghostCircle').attr('class', 'ghostCircle show');
        d3.select(domNode).attr('class', 'node activeDrag');

        svgGroup.selectAll("g.node").sort(function(a, b) { // select the parent and sort the path's
            if (a.id != draggingNode.id) return 1; // a is not the hovered element, send "a" to the back
            else return -1; // a is the hovered element, bring "a" to the front
        });
        // if nodes has children, remove the links and nodes
        if (nodes.length > 1) {
            // remove link paths
            links = tree.links(nodes);
            nodePaths = svgGroup.selectAll("path.link")
                .data(links, function(d) {
                    return d.target.id;
                }).remove();
            // remove child nodes
            nodesExit = svgGroup.selectAll("g.node")
                .data(nodes, function(d) {
                    return d.id;
                }).filter(function(d, i) {
                    if (d.id == draggingNode.id) {
                        return false;
                    }
                    return true;
                }).remove();
        }

        // remove parent link
        parentLink = tree.links(tree.nodes(draggingNode.parent));
        svgGroup.selectAll('path.link').filter(function(d, i) {
            if (d.target.id == draggingNode.id) {
                return true;
            }
            return false;
        }).remove();

        dragStarted = null;
    }

    // define the baseSvg, attaching a class for styling and the zoomListener
    var baseSvg = d3.select("#tree-container").append("svg")
        .attr("width", viewerWidth)
        .attr("height", viewerHeight);
        
    baseSvg.append("rect")
        .attr("width", "100%")
        .attr("height", "100%")
        .attr("fill", "white")
        
    baseSvg.call(zoomListener);


    // Define the drag listeners for drag/drop behaviour of nodes.
    dragListener = d3.behavior.drag()
        .on("dragstart", function(d) {
            if (d == root) {
                return;
            }
            dragStarted = true;
            nodes = tree.nodes(d);
            d3.event.sourceEvent.stopPropagation();
            // it's important that we suppress the mouseover event on the node being dragged. Otherwise it will absorb the mouseover event and the underlying node will not detect it d3.select(this).attr('pointer-events', 'none');
        })
        .on("drag", function(d) {
            if (d == root) {
                return;
            }
            if (dragStarted) {
                domNode = this;
                initiateDrag(d, domNode);
            }

            // get coords of mouseEvent relative to svg container to allow for panning
            relCoords = d3.mouse($('svg').get(0));
            if (relCoords[0] < panBoundary) {
                panTimer = true;
                pan(this, 'left');
            } else if (relCoords[0] > ($('svg').width() - panBoundary)) {

                panTimer = true;
                pan(this, 'right');
            } else if (relCoords[1] < panBoundary) {
                panTimer = true;
                pan(this, 'up');
            } else if (relCoords[1] > ($('svg').height() - panBoundary)) {
                panTimer = true;
                pan(this, 'down');
            } else {
                try {
                    clearTimeout(panTimer);
                } catch (e) {

                }
            }

            d.x0 += d3.event.dy;
            d.y0 += d3.event.dx;
            var node = d3.select(this);
            node.attr("transform", "translate(" + d.y0 + "," + d.x0 + ")");
            updateTempConnector();
        }).on("dragend", function(d) {
            if (d == root) {
                return;
            }
            domNode = this;
            if (selectedNode) {
                // now remove the element from the parent, and insert it into the new elements children
                var index = draggingNode.parent.children.indexOf(draggingNode);
                if (index > -1) {
                    draggingNode.parent.children.splice(index, 1);
                }
                if (typeof selectedNode.children !== 'undefined' || typeof selectedNode._children !== 'undefined') {
                    if (typeof selectedNode.children !== 'undefined') {
                        selectedNode.children.push(draggingNode);
                    } else {
                        selectedNode._children.push(draggingNode);
                    }
                } else {
                    selectedNode.children = [];
                    selectedNode.children.push(draggingNode);
                }
                // Make sure that the node being added to is expanded so user 
				//can see added node is correctly moved
                expand(selectedNode);
                sortTree();
                endDrag();
            } else {
                endDrag();
            }
        });

    function endDrag() {
        selectedNode = null;
        d3.selectAll('.ghostCircle').attr('class', 'ghostCircle');
        d3.select(domNode).attr('class', 'node');
        // now restore the mouseover event or we won't be able to drag a 2nd time
        d3.select(domNode).select('.ghostCircle').attr('pointer-events', '');
        updateTempConnector();
        if (draggingNode !== null) {
            update(root);
            centerNode(draggingNode);
            draggingNode = null;
        }
    }

 // color a node properly
  function colorNode(d) {
        result = "#fff";
        if (d.synthetic == true) {
          result = (d._children || d.children) ? "darkgray" : "lightgray";
        }
        else {
          if (d.type == "USDA") {
            result = (d._children || d.children) ? "orangered" : "orange";
          } else if (d.type == "Produce") {
            result = (d._children || d.children) ? "yellowgreen" : "yellow";
          } else if (d.type == "RecipeIngredient") {
            result = (d._children || d.children) ? "skyblue" : "royalblue";
          } else {
            result = "lightsteelblue"
          }
        }
        return result;
    }


    // Function to update the temporary connector indicating dragging affiliation
    var updateTempConnector = function() {
        var data = [];
        if (draggingNode !== null && selectedNode !== null) {
            // have to flip the source coordinates since we did this for the existing connectors on the original tree
            data = [{
                source: {
                    x: selectedNode.y0,
                    y: selectedNode.x0
                },
                target: {
                    x: draggingNode.y0,
                    y: draggingNode.x0
                }
            }];
        }
        var link = svgGroup.selectAll(".templink").data(data);

        link.enter().append("path")
            .attr("class", "templink")
            .attr("d", d3.svg.diagonal())
            .attr('pointer-events', 'none');

        link.attr("d", d3.svg.diagonal());

        link.exit().remove();
    };

    // Function to center node when clicked/dropped so node doesn't get lost when collapsing/moving with large amount of children.

    function centerNode(source) {
        scale = zoomListener.scale();
        x = -source.y0;
        y = -source.x0;
        x = x * scale + viewerWidth / 2;
        y = y * scale + viewerHeight / 2;
        d3.select('g').transition()
            .duration(duration)
            .attr("transform", "translate(" + x + "," + y + ")scale(" + scale + ")");
        zoomListener.scale(scale);
        zoomListener.translate([x, y]);
    }



var i = 0,
    duration = 750,
    rectW = 60,
    rectH = 30;


var diagonal = d3.svg.diagonal()
    .projection(function (d) {
    return [d.x + rectW / 2, d.y + rectH / 2];
});

var svg = d3.select("#body").append("svg").attr("width", 1000).attr("height", 1000)
    .call(zm = d3.behavior.zoom().scaleExtent([1,3]).on("zoom", redraw)).append("g")
    .attr("transform", "translate(" + 350 + "," + 20 + ")");

//necessary so that zoom knows where to zoom and unzoom from
zm.translate([350, 20]);

root.x0 = 0;
root.y0 = height / 2;

function collapse(d) {
    if (d.children) {
        d._children = d.children;
        d._children.forEach(collapse);
        d.children = null;
    }
}

root.children.forEach(collapse);
update(root);

d3.select("#body").style("height", "800px");

function update(source) {

    // Compute the new tree layout.
    var nodes = tree.nodes(root).reverse(),
        links = tree.links(nodes);
		

    // Normalize for fixed-depth.
    nodes.forEach(function (d) {
        d.y = d.depth * 180;
    });

    // Update the nodes…
    var node = svg.selectAll("g.node")
        .data(nodes, function (d) {
        return d.id || (d.id = ++i);
    });
	

// Add a context menu
      //  node.on('contextmenu', d3.contextMenu(menu));



    // Enter any new nodes at the parent's previous position.
    var nodeEnter = node.enter().append("g")
        .attr("class", "node")
        .attr("transform", function (d) {
        return "translate(" + source.x0 + "," + source.y0 + ")";
    })
        .on("click", click);
		
		
		/*
		.on("contextmenu", function(){
	   console.log ("Right Click");
			});
			*/
			
			
			/*
			 // Add a context menu
        node.on('contextmenu', d3.contextMenu(menu));
			*/

		

    nodeEnter.append("rect")
        .attr("width", rectW)
        .attr("height", rectH)
        .attr("stroke", "black")
        .attr("stroke-width", 1)
        .style("fill", function (d) {
        return d._children ? "lightsteelblue" : "#fff";
    })
	.on('contextmenu', d3.contextMenu(menu));
	 

//Ori start
    nodeEnter.append("text")
        .attr("x", rectW / 2)
        .attr("y", rectH / 2)
        .attr("dy", ".35em")
        .attr("text-anchor", "middle")
        .text(function (d) {
        return d.name;
    })
	.on('contextmenu', d3.contextMenu(menu));
	//Ori end */
	
	
	
	 // Update the text to reflect whether node has children or not.
        node.select('text')
            .attr("text-anchor", "middle")
            .text(function(d) {
                return d.name;
            });





    // Transition nodes to their new position.
    var nodeUpdate = node.transition()
        .duration(duration)
        .attr("transform", function (d) {
        return "translate(" + d.x + "," + d.y + ")";
    });

    nodeUpdate.select("rect")
        .attr("width", rectW)
        .attr("height", rectH)
        .attr("stroke", "black")
        .attr("stroke-width", 1)
        .style("fill", function (d) {
        return d._children ? "lightsteelblue" : "#fff";
    });

    nodeUpdate.select("text")
        .style("fill-opacity", 1);

    // Transition exiting nodes to the parent's new position.
    var nodeExit = node.exit().transition()
        .duration(duration)
        .attr("transform", function (d) {
        return "translate(" + source.x + "," + source.y + ")";
    })
        .remove();

    nodeExit.select("rect")
        .attr("width", rectW)
        .attr("height", rectH)
    //.attr("width", bbox.getBBox().width)""
    //.attr("height", bbox.getBBox().height)
    .attr("stroke", "black")
        .attr("stroke-width", 1);

    nodeExit.select("text");

    // Update the links…
    var link = svg.selectAll("path.link")
        .data(links, function (d) {
        return d.target.id;
    });

    // Enter any new links at the parent's previous position.
    link.enter().insert("path", "g")
        .attr("class", "link")
        .attr("x", rectW / 2)
        .attr("y", rectH / 2)
        .attr("d", function (d) {
        var o = {
            x: source.x0,
            y: source.y0
        };
        return diagonal({
            source: o,
            target: o
        });
    });

    // Transition links to their new position.
    link.transition()
        .duration(duration)
        .attr("d", diagonal);

    // Transition exiting nodes to the parent's new position.
    link.exit().transition()
        .duration(duration)
        .attr("d", function (d) {
        var o = {
            x: source.x,
            y: source.y
        };
        return diagonal({
            source: o,
            target: o
        });
    })
        .remove();

    // Stash the old positions for transition.
    nodes.forEach(function (d) {
        d.x0 = d.x;
        d.y0 = d.y;
    });
}


outer_update = update;

 // Append a group which holds all nodes and which the zoom Listener can act upon.
    var svgGroup = baseSvg.append("g");

    // Define the root
    root = treeData;
    root.x0 = viewerHeight / 2;
    root.y0 = 0;

    // Layout the tree initially and center on the root node.
    update(root);
    centerNode(root);
    tree_root = root;



// Toggle children on click.
function click(d) {
if (d3.event.defaultPrevented) return; // click suppressed
           if (d.children) {
        d._children = d.children;
        d.children = null;
    } else {
        d.children = d._children;
        d._children = null;
    }
    update(d);
}

//Redraw for zoom
function redraw() {
  //console.log("here", d3.event.translate, d3.event.scale);
  svg.attr("transform",
      "translate(" + d3.event.translate + ")"
      + " scale(" + d3.event.scale + ")");
}


  //]]>
  </script>

  <script>
    // tell the embed parent frame the height of the content
    if (window.parent && window.parent.parent){
      window.parent.parent.postMessage(["resultsFrame", {
        height: document.body.getBoundingClientRect().height,
        slug: "8bdx4q0e"
      }], "*")
    }

    // always overwrite window.name, in case users try to set it manually
    window.name = "result"
	
	console.log (root);
	console.log (tree);
	
	

	
  </script>


</body>
</html>
